//プロパティ
:lang: ja 
:doctype: articles
:toc: left
:toclevels: 3
:toc-title: 目次
:sectnums:
:sectnumlevels: 4
:sectlinks:
:imagesdir: images
:icons: font
:source-highlighter: coderay
:example-caption: 例
:table-caption: 表
:figure-caption: 図
:docname: Git NOTE
:author: Ponpokopon

// 本文
= {docname}

== Gitってなに？
ファイルのバージョン管理するソフトウェア。

* ファイルの最新の状態がわかる
* いつ・誰が・何を変更したかもわかる
* 以前の状態に戻せる
* 複数人での編集に対応している

=== Gitの歴史
リーナス・トーバルズがLinuxのカーネル開発で使用されていたバージョン管理システムのライセンス変更に伴い、次期バージョン管理システムを検討し始めたが、高度な要求水準を満たすものがなかった。

2005年からGitのプログラム開発が開始。

* スピード
* シンプルな設計
* ブランチが並列で開発可能
* 大規模プロジェクトが効率的に行える

=== GitHubってなに？
クリスワンストラスが創業者のサービス。コード（Gitリポジトリ）のホスティングサービス。

* プルリクエストで複数人開発
** 変更の取り込みをリクエスト、コミュニケーションが可能
** コードレビューがしやすくなった
* 世界中のチームがGitHub上で開発可能
** 一般のエンジニアがオープンソース開発に参加可能

他にもBitbucketなどのホスティングサービスもある。

== Git環境構築

=== Gitのインストール

. 下記のサイトからGit for Windowsのインストーラをダウンロードする。
+
link:https://gitforwindows.org/[Git for Windows]

. 全部初期設定のまま、インストールする。

. インストールした中にある「Git Bash」を起動し、下記のコマンドを投入する。
+
[source,git]
----
git -version
----

. インストールしたバージョンが表示されることを確認する。


=== Githubへの登録

. 下記のサイトからGithubへサインアップする。
+
link:https://github.com/[Github]

. Email認証を行う。

. Githubにログインできることを確認する。

=== Gitの初期設定

. 「Git Bash」を起動する。

. 下記のコマンドを投入し、ユーザ名を登録する。
+
[source,git]
----
git config --global user.name "hogehoge"
----
. 下記のコマンドを投入し、メールアドレスを登録する。
+
[source,git]
----
git config --global user.email hoge@hoge.com
----

. 下記のコマンドを投入し、エディターを設定する。
+
[[app-listing]]
[source,git]
.Visual Studio Code
----
git config --global core.editor 'code --wait'
----
+
[[app-listing]]
[source,git]
.Atom
----
git config --global core.editor 'atom --wait'
----

. 下記のコマンドを投入し、設定を確認する。
+
[[app-listing]]
[source,git]
----
git config user.name // <1>
git config user.email // <2>
git config core.editor // <3>
git config --list //<4>
----
<1> ユーザ名表示
<2> メールアドレス表示
<3> エディター表示
<4> 全設定をリスト表示

[Tips]
====
ここで設定した設定は「C:\\Users\username\.gitconfig」に保存されている。
====

== Gitの仕組み

=== Gitのメリット

_Q.Gitのバージョン管理ではスナップショットで保存しているか？それとも差分で保存しているか？_

A.スナップショット

まるまるデータを保存していくため、ブランチを切ったり、マージしたりがしやすくなった。

コミットをたどることで以前の状態に辿りながら戻せる。

=== Gitの作業の流れ

. ワークツリー領域でファイルを作成
. 「git add」コマンドを実行
. ローカルリポジトリ領域にファイル内容を元にした圧縮ファイルを作成
. ステージ領域に圧縮ファイルとファイル名を関連付けるインデックスを作成
. 「git commit」コマンドを実行
. ローカルリポジトリ領域にステージ領域のインデックスを元にツリーを作成
. ローカルリポジトリ領域にツリーのプロパティ（親コミット、作成者、日付、コメント）を示すコミットを作成


=== Gitのデータ構造

* ローカルリポジトリに「圧縮ファイル」「ツリー」「コミット」ファイルを作成することでデータを保存している
* コミットが親コミットを持つことで変更履歴を辿る事ができる
* **Git**とは**「データを圧縮して、スナップショットとして保存、ツリーとコミットによって、時系列の依存関係を保存し、バージョン管理をしているアプリケーション」**

== Gitを使おう

=== 新規でローカルリポジトリを作ろう

. 「Git Bash」を起動する

. プロジェクトのディレクトリを作成し、直下に移動する
+
[[app-listing]]
[source,git]
----
mkdir [ディレクトリ名]
cd [ディレクトリ名]
----

. 下記のコマンドを投入し、ローカルリポジトリを作成する
+
[[app-listing]]
[source,git]
----
git init
----

=== リモートリポジトリを元にローカルリポジトリを作ろう

. リモートリポジトリのURLを入手する

. 「Git Bash」を起動する

. プロジェクトのディレクトリを作成したいディレクトリの直下に移動する
+
[[app-listing]]
[source,git]
----
cd [ディレクトリ名]
----

. 下記のコマンドを投入し、リモートリポジトリを複製する
+
[[app-listing]]
[source,git]
----
git clone [リモートリポジトリのURL]
----

=== ファイルの変更をステージに追加しよう

*_Q . なぜステージ領域を使いますか？_*

**A . リポジトリへ変更したい変更だけを選択するため。**

. 下記のコマンドを投入し、ファイルの変更をステージに追加する
+
[[app-listing]]
[source,git]
.変更範囲を指定
----
git add [ファイル名またはディレクトリ名]
----
+
[[app-listing]]
[source,git]
.全範囲を指定
----
git add .
----

=== ファイルの変更を記録しよう

. 下記のコマンドを投入し、ファイルの変更を記録する
+
[[app-listing]]
[source,git]
.optionなし
----
git commit
----

. エディターが立ち上がる

. エディターにコミットメッセージを記載し、保存する

. ターミナルを確認し、コミットメッセージ、コミットした内容が表示されていることを確認する

=== どのファイルが変更されたかを確認しよう

. 下記のコマンドを投入し、ファイルの変更を確認する
+
[[app-listing]]
[source,git]
----
git status
----

. ターミナルを確認し、ワークツリーとステージ、ステージとコミットの変更点を確認する

=== ファイルの変更内容を確認しよう

. 下記のコマンドを投入し、ファイルの変更を確認する
+
[[app-listing]]
[source,git]
.ワークツリーとステージ
----
git diff [ファイル名]
----
+
[[app-listing]]
[source,git]
.ステージとコミット
----
git diff --staged [ファイル名]
----

. ターミナルを確認し、ワークツリーとステージ、ステージとコミットの変更点を確認する

=== ファイルを削除しよう

. 下記のコマンドを投入し、ファイルを削除する
+
[[app-listing]]
[source,git]
.リポジトリとワークツリーから削除する
----
git rm [ファイル名]
git rm [ディレクトリ名]
----
+
[[app-listing]]
[source,git]
.リポジトリからのみ削除する
----
git rm --cached [ファイル名]
----

. 「ls」または「git status」で削除されていることを確認する

=== ファイルを移動（またはリネーム）しよう

. 下記のコマンドを投入し、ファイルを移動する
+
[[app-listing]]
[source,git]
----
git mv [旧ファイル名] [新ファイル名]
----
下記を順に実行するのと同じ。
+
[[app-listing]]
[source,git]
----
mv [旧ファイル名] [新ファイル名]
git rm [旧ファイル名]
git add [新ファイル名]
----

. 「ls」または「git status」で移動されていることを確認する

=== ファイルをリモートリポジトリに記録しよう

. リモートリポジトリを作成する
+
*Githubの場合*
+
.. Githubにログインする
.. 右上のプロフィールメニューから「Your Repository」をクリックする
.. 表示された画面の「Repository」タブをクリックする
.. btn:[NEW]をクリックする
.. リポジトリ名を入力し、btn:[Create Repository]をクリックする
.. リポジトリが作成されたことを確認する

. 下記のコマンドを投入し、リモートリポジトリを設定する
+
[[app-listing]]
[source,git]
----
git remote add [リモート名] [リモートリポジトリのアドレス]
----

. 下記のコマンドを投入し、ファイルをリモートリポジトリに記録する
+
[[app-listing]]
[source,git]
----
git push [リモート名] [ブランチ名]
----

. リモートリポジトリが更新されていることを確認する

=== コマンドにエイリアスをつけよう

. 下記のコマンドを投入し、エイリアスを設定する
+
[[app-listing]]
[source,git]
----
git config --global alias.[エイリアス名] [コマンド名]
----
+
[[app-listing]]
[source,git]
----
git config --global alias.ci commit
git config --global alias.st status
git config --global alias.br branch
git config --global alias.co checkout
----

=== バージョン管理しないファイルを無視しよう

*_Q . どんなファイルはバージョン管理しない？_*

**A . 機密情報やチーム開発に利用しないファイル** +
**.gitignoreファイルを利用する**

. 「.gitignore」ファイルを追加し、中身に無視したいファイル名やディレクトリ名を記載する

=== ワークツリーのファイルの変更を元に戻そう

. 下記のコマンドを投入し、ファイルをステージの状態に戻す
+
[[app-listing]]
[source,git]
.変更範囲を指定
----
git checkout -- [ファイル名またはディレクトリ名]
----
+
[[app-listing]]
[source,git]
.全範囲を指定
----
git checkout -- .
----

. ワークツリーの内容が戻っていることを確認する

=== ステージのファイルの変更を元に戻そう

. 下記のコマンドを投入し、ファイルをステージの状態に戻す
+
[[app-listing]]
[source,git]
.変更範囲を指定
----
git reset HEAD [ファイル名またはディレクトリ名]
----
+
[[app-listing]]
[source,git]
.全範囲を指定
----
git reset HEAD .
----

. ステージの内容が戻っていることを確認する

[NOTE]
====
このコマンドでワークツリーへは何も変化が起きないことに注意。
====

=== 直前のコミットをやり直そう

. 下記のコマンドを投入し、コミットをひとつ前の状態に戻す
+
[[app-listing]]
[source,git]
----
git commit --amend
----

. コミットの内容が戻っていることを確認する

[WARNING]
====
このコマンドはリモートリポジトリにプッシュしたコミットは修正しないこと。プッシュした内容を修正したい場合は、追加で過去のコミットは取り消さず、修正したものを改めてコミットをする。
====

== 用語集

IT一般::
  
Git特有::
  用語:::
    * *ワークツリー* +
    
    * *ステージ* +

    * *ローカルリポジトリ* +

    * *リモートリポジトリ* +

    * *Git Object* +
    「.git/objects」配下に保存されるgitデータ
    ** *Blob Object* +
    ファイルをハッシュ関数で40文字の英数字に変換したもの
    ** *Tree Object* +
    Blob ObjectまたはTree Objectとファイル名を紐付けたもの +
    ディレクトリ階層がある場合、子ディレクトリのTree Objectは親ディレクトリのTree Object内に含まれる
    ** *Commit Object* +
    コミットした時点でのファイルとその構成、状態を示したもの +
    最上位のTree Object、親Commit Object、変更者情報、変更コメントが記載される

  コマンド:::
    * *git config* +
    aaaaaa
    * *git add* +
    aaaaaa
    * *git commit* +
     